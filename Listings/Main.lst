C51 COMPILER V9.54   MAIN                                                                  10/17/2015 14:12:04 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\Main.obj
COMPILER INVOKED BY: D:\Keil_MDK\C51\BIN\C51.EXE Main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Mai
                    -n.lst) OBJECT(.\Objects\Main.obj)

line level    source

   1          //*************************************************************//
   2          //                                      ÖÇÄÜÎÂÊÒ¼à¿Ø´óÅï
   3          //                              µ¥Æ¬»ú AT89S52 »ò STC89C52RC 
   4          //                                      Ryan_yuans      2015.10
   5          //*************************************************************//
   6          
   7          #define _MAIN_C
   8          
   9          #include "CONFIG.H"
  10          #include "DHT11.H"
  11          #include "LCD1602.H"
  12          #include "GSM.H"
  13          
  14          
  15          
  16          
  17          //----------------------------------------------//
  18          //----------------¶¨ÒåÇø--------------------//
  19          //----------------------------------------------//
  20          
  21          U8 T0RH = 0;
  22          U8 T0RL = 0;
  23          U8 T1RH = 0;
  24          U8 T1RL = 0;
  25          U16 flag1s = 0;
  26          U16 flag3s = 0;
  27          uchar str[10];
  28          U8 enbuzz1 = 0,enbuzz2 = 0,enbuzz3 = 0;
  29          U8 ENA_Temp1 = 0,ENA_Temp2 = 0;
  30          U8 SendOn = 2;
  31          
  32          void TrasfToString(U8 *str,U8 dat)              // °Ñ¶ÁÈ¡µÄÊý¾Ý×ª»¯³É×Ö·û´®
  33          {
  34   1              signed char i = 0;
  35   1              uchar len = 0;
  36   1              uchar buf[6];
  37   1              
  38   1              if(dat < 0)
  39   1              {
  40   2                      dat = -dat;
  41   2                      *str++ = '-';
  42   2                      len++;
  43   2              }
  44   1              
  45   1              do
  46   1              {
  47   2                      buf[i++] = dat % 10;
  48   2                      dat /= 10;
  49   2              }while(dat > 0);
  50   1              
  51   1              len += i;
  52   1              
  53   1              while(i-- > 0)
  54   1              {
C51 COMPILER V9.54   MAIN                                                                  10/17/2015 14:12:04 PAGE 2   

  55   2                      *str++ = buf[i] + '0';
  56   2              }
  57   1              
  58   1              *str = '\0';
  59   1      
  60   1      }
  61          
  62          
  63          void ConfigTimer0(U16 ms)       // ÉèÖÃ¶¨Ê±Æ÷T0 µ×²ãÇý¶¯
  64          {
  65   1              U32 tmp;
  66   1              
  67   1              tmp = 11059200 / 12;
  68   1              tmp = (tmp * ms) / 1000;
  69   1              tmp = 65536 - tmp;
  70   1              tmp = tmp + 13;
  71   1              T0RH = (uchar)(tmp >> 8);
  72   1              T0RL = (uchar)tmp;
  73   1              TH0 = T0RH;
  74   1              TL0 = T0RL;
  75   1              TMOD &= 0XF0;
  76   1              TMOD |= 0X01;
  77   1              ET0 = 1;
  78   1              TR0 = 1;
  79   1      }
  80          
  81          /*
  82          void ConfigTimer1(U16 ms)       // ÉèÖÃ¶¨Ê±Æ÷T1 µ×²ãÇý¶¯
  83          {
  84                  U32 tmp;
  85                  
  86                  tmp = 11059200 / 12;
  87                  tmp = (tmp * ms) / 1000;
  88                  tmp = 65536 - tmp;
  89                  tmp = tmp + 2;
  90                  T1RH = (uchar)(tmp >> 8);
  91                  T1RL = (uchar)tmp;
  92                  TH1 = T0RH;
  93                  TL1 = T0RL;
  94                  TMOD &= 0X0F;
  95                  TMOD |= 0X10;
  96                  ET1 = 1;
  97                  TR1 = 1;
  98          }
  99          */
 100          
 101          void ConfigTimer2(U16 baud)             // ·äÃùÆ÷ ¿ØÖÆ
 102          {
 103   1          //ÅäÖÃT2×÷Îª¶¯Ì¬É¨Ãè¶¨Ê±
 104   1          T2CON = 0x00;  //ÅäÖÃT2¹¤×÷ÔÚ16Î»×Ô¶¯ÖØÔØ¶¨Ê±Æ÷Ä£Ê½
 105   1          RCAP2H = ((65536 - SYS_MCLK/baud) >> 8);  //ÅäÖÃÖØÔØÖµ£¬Ã¿Ãë²úÉú1500´ÎÖÐ¶Ï£¬                        SYS_MCLK   (11059200/
             -12)
 106   1          RCAP2L = (65536 - SYS_MCLK/baud);       //ÒÔÊ¹Ë¢ÐÂÂÊ´ïµ½100HzÎÞÉÁË¸µÄÐ§¹û                           ÏµÍ³Ö÷Ê±ÖÓÆµÂÊ£¬¼´Õñµ´Æ÷Æ
             -µÂÊ¡Â12
 107   1          TH2 = RCAP2H;  //ÉèÖÃ³õÖµµÈÓÚÖØÔØÖµ
 108   1          TL2 = RCAP2L;
 109   1          ET2 = 1;       //Ê¹ÄÜT2ÖÐ¶Ï
 110   1          PT2 = 1;       //ÉèÖÃT2ÖÐ¶ÏÎª¸ßÓÅÏÈ¼¶
 111   1          TR2 = 1;       //Æô¶¯T2
 112   1      }
 113          
 114          void ShowTempHumi()                     // ÏÔÊ¾ÎÂÊª¶ÈÖÁÒº¾§ÆÁ
C51 COMPILER V9.54   MAIN                                                                  10/17/2015 14:12:04 PAGE 3   

 115          {
 116   1              
 117   1              TrasfToString(str,U8T_data_H);
 118   1              ShowStr(6,0,str);
 119   1              TrasfToString(str,U8RH_data_H);
 120   1              ShowStr(6,1,str);
 121   1      }
 122          
 123          void Alarm_Monitor()            // ¼à¿Ø¸÷Ö¸±ê_ ÎÂ¶È¡¢Êª¶È¡¢ÓÐº¦ÆøÌåÅ¨¶È
 124          {
 125   1              
 126   1                      if(U8T_data_H >= 35)    // µ±ÎÂ¶È >= 35¡ãC Ê±
 127   1                      {
 128   2                              ShowStr(14,0,"!~");
 129   2                              ENA_Temp2 = 1;
 130   2                              enbuzz2 = 1;
 131   2                      }
 132   1                      else
 133   1                      {
 134   2                              ShowStr(14,0,"  ");
 135   2                              ENA_Temp2 = 0;
 136   2                              enbuzz2 = 0;
 137   2                      }
 138   1                      
 139   1                      if(U8RH_data_H >= 60)   // µ±Êª¶È >= 60% Ê±
 140   1                      {
 141   2                              ShowStr(14,1,"!~");
 142   2                              enbuzz3 = 1;
 143   2                      }
 144   1                      else
 145   1                      {
 146   2                              ShowStr(14,1,"  ");
 147   2                              enbuzz3 = 0;
 148   2                      }
 149   1                      
 150   1                      if(SOIL == 1)
 151   1                      {
 152   2                              ShowStr(14,0,"!~");
 153   2                      }
 154   1                      else
 155   1                      {
 156   2                              ShowStr(14,1,"!~");
 157   2                      }
 158   1                      
 159   1                      if(DOUT==0)             // ¼ì²âÓÐº¦ÆøÌåÅ¨¶ÈÊÇ·ñ³¬±ê
 160   1                              {
 161   2                                      Delay(1);       // ÑÓÊ±ÔÙ´ÎÈ·ÈÏ
 162   2                                      if(DOUT == 0)   // µ±ÓÐº¦ÆøÌåÅ¨¶È³¬±ê
 163   2                                      {
 164   3                                              enbuzz1 = 1;
 165   3                                              ENA_Temp1 = 1;
 166   3                                              
 167   3                                              if(SendOn == 2)
 168   3                                              {
 169   4                                                       SendOn = 1; 
 170   4                                              }
 171   3                                              
 172   3                                      }
 173   2                              }
 174   1                       else
 175   1                              {
 176   2                                      enbuzz1 = 0;
C51 COMPILER V9.54   MAIN                                                                  10/17/2015 14:12:04 PAGE 4   

 177   2                                      ENA_Temp1 = 0;
 178   2                              }
 179   1                              
 180   1      }
 181          /*
 182          void Alarm_Action()                     // Ö¸±êÒì³£ Ö´ÐÐ²Ù×÷
 183          {
 184                  if((ENA_Temp1 == 1) || (ENA_Temp2 == 1))        // Æô¶¯·çÉÈ ³é·ç ½µÎÂ
 185                  {
 186                          ENA = 1;
 187                  }
 188                  else
 189                  {
 190                          ENA = 0;
 191                  }
 192          }
 193          */
 194          //----------------------------------------------
 195          void main()
 196          {
 197   1              P1 = 0xff;
 198   1              
 199   1              EA = 1;
 200   1              ConfigTimer0(20);               // 20 X 50 = 1 S
 201   1              ConfigTimer2(1000);             // Ã¿Ãë 1000´Î
 202   1              Init1602();
 203   1              SerialInti();
 204   1              
 205   1              ShowStr(0,0,"Temp:");
 206   1              ShowStr(0,1,"Humi:");
 207   1              
 208   1              Delay(1);         //ÑÓÊ±100US£¨12M¾§Õñ)
 209   1              
 210   1              while(1)
 211   1              {
 212   2                      
 213   2      /*  µ÷ÓÃÎÂÊª¶È¶ÁÈ¡×Ó³ÌÐò ¶ÁÈ¡ÎÂÊª¶È£¡ */
 214   2                      R_HT();
 215   2                              
 216   2                              
 217   2                      if(flag1s == 1)         
 218   2                      {
 219   3                              flag1s = 0;
 220   3                              
 221   3                              ShowTempHumi();         // ½«ÎÂÊª¶ÈÏÔÊ¾ÔÚÒº¾§ÆÁÉÏ
 222   3                              
 223   3                              Alarm_Monitor();        // ¼à¿Ø¸÷Ö¸±ê
 224   3                              
 225   3                              //Alarm_Action();               // ·çÉÈ»ú  , ÏÂÃæÖÐ¶Ï¿ØÖÆ£¡~
 226   3                      }               
 227   2                      
 228   2              }//while
 229   1              
 230   1      }// main
 231          
 232          // ---------------------------------------------
 233          void Timer0() interrupt 1
 234          {
 235   1              static U8 timer1 = 0;
 236   1              
 237   1              TH0 = T0RH;
 238   1              TL0 = T0RL;
C51 COMPILER V9.54   MAIN                                                                  10/17/2015 14:12:04 PAGE 5   

 239   1              
 240   1              
 241   1              timer1++;
 242   1              
 243   1              if(timer1 == 50)                // ¼ÆÊ± 20 X 50 ==> 1 S
 244   1              {
 245   2                      timer1 = 0;
 246   2                      flag1s = 1;
 247   2              }
 248   1              
 249   1              if((ENA_Temp1 == 1) || (ENA_Temp2 == 1))        // Æô¶¯·çÉÈ ³é·ç ½µÎÂ***************************
 250   1              {
 251   2                      // ENA = 1;
 252   2              }
 253   1              else
 254   1              {
 255   2                      // ENA = 0;
 256   2              }
 257   1              
 258   1              if(SendOn == 1)
 259   1              {
 260   2                      SendOn = 0;
 261   2                      Sendit();
 262   2              }
 263   1      }
 264          
 265          void Timer2() interrupt 5
 266          {
 267   1              TF2 = 0;  //ÇåÁãT2ÖÐ¶Ï±êÖ¾
 268   1              
 269   1              if((enbuzz1 == 1) || (enbuzz2 == 1) || ((enbuzz3 == 1)))        // ´ò¿ª·äÃùÆ÷ ~BUZZ
 270   1              {
 271   2                      BUZZ = ~BUZZ;
 272   2              }
 273   1              else
 274   1              {
 275   2                      BUZZ = 1;
 276   2              }
 277   1              
 278   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    704    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
