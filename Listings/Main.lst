C51 COMPILER V9.54   MAIN                                                                  10/12/2015 11:40:48 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\Main.obj
COMPILER INVOKED BY: D:\Keil_MDK\C51\BIN\C51.EXE Main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Mai
                    -n.lst) OBJECT(.\Objects\Main.obj)

line level    source

   1          //*************************************************************//
   2          //                                      ÖÇÄÜÎÂÊÒ¼à¿Ø´óÅï
   3          //                              µ¥Æ¬»ú AT89S52 »ò STC89C52RC 
   4          //                                      Ryan_yuans      2015.10
   5          //*************************************************************//
   6          
   7          #define _MAIN_C
   8          
   9          #include "CONFIG.H"
  10          #include "DHT11.H"
  11          #include "LCD1602.H"
  12          #include "GSM.H"
  13          
  14          
  15          
  16          
  17          //----------------------------------------------//
  18          //----------------¶¨ÒåÇø--------------------//
  19          //----------------------------------------------//
  20          
  21          U8 T0RH = 0;
  22          U8 T0RL = 0;
  23          U8 T1RH = 0;
  24          U8 T1RL = 0;
  25          U16 flag1s = 0;
  26          U16 flag3s = 0;
  27          uchar str[10];
  28          U8 enbuzz1 = 0,enbuzz2 = 0,enbuzz3 = 0;
  29          U8 ENA_Temp1 = 0,ENA_Temp2 = 0;
  30          U8 SendOn = 2;
  31          
  32          void TrasfToString(U8 *str,U8 dat)              // °Ñ¶ÁÈ¡µÄÊý¾Ý×ª»¯³É×Ö·û´®
  33          {
  34   1              signed char i = 0;
  35   1              uchar len = 0;
  36   1              uchar buf[6];
  37   1              
  38   1              if(dat < 0)
  39   1              {
  40   2                      dat = -dat;
  41   2                      *str++ = '-';
  42   2                      len++;
  43   2              }
  44   1              
  45   1              do
  46   1              {
  47   2                      buf[i++] = dat % 10;
  48   2                      dat /= 10;
  49   2              }while(dat > 0);
  50   1              
  51   1              len += i;
  52   1              
  53   1              while(i-- > 0)
  54   1              {
C51 COMPILER V9.54   MAIN                                                                  10/12/2015 11:40:48 PAGE 2   

  55   2                      *str++ = buf[i] + '0';
  56   2              }
  57   1              
  58   1              *str = '\0';
  59   1      
  60   1      }
  61          
  62          
  63          void ConfigTimer0(U16 ms)       // ÉèÖÃ¶¨Ê±Æ÷T0 µ×²ãÇý¶¯
  64          {
  65   1              U32 tmp;
  66   1              
  67   1              tmp = 11059200 / 12;
  68   1              tmp = (tmp * ms) / 1000;
  69   1              tmp = 65536 - tmp;
  70   1              tmp = tmp + 13;
  71   1              T0RH = (uchar)(tmp >> 8);
  72   1              T0RL = (uchar)tmp;
  73   1              TH0 = T0RH;
  74   1              TL0 = T0RL;
  75   1              TMOD &= 0XF0;
  76   1              TMOD |= 0X01;
  77   1              ET0 = 1;
  78   1              TR0 = 1;
  79   1      }
  80          
  81          /*
  82          void ConfigTimer1(U16 ms)       // ÉèÖÃ¶¨Ê±Æ÷T1 µ×²ãÇý¶¯
  83          {
  84                  U32 tmp;
  85                  
  86                  tmp = 11059200 / 12;
  87                  tmp = (tmp * ms) / 1000;
  88                  tmp = 65536 - tmp;
  89                  tmp = tmp + 2;
  90                  T1RH = (uchar)(tmp >> 8);
  91                  T1RL = (uchar)tmp;
  92                  TH1 = T0RH;
  93                  TL1 = T0RL;
  94                  TMOD &= 0X0F;
  95                  TMOD |= 0X10;
  96                  ET1 = 1;
  97                  TR1 = 1;
  98          }
  99          */
 100          
 101          void ConfigTimer2(U16 baud)             // ·äÃùÆ÷ ¿ØÖÆ
 102          {
 103   1          //ÅäÖÃT2×÷Îª¶¯Ì¬É¨Ãè¶¨Ê±
 104   1          T2CON = 0x00;  //ÅäÖÃT2¹¤×÷ÔÚ16Î»×Ô¶¯ÖØÔØ¶¨Ê±Æ÷Ä£Ê½
 105   1          RCAP2H = ((65536 - SYS_MCLK/baud) >> 8);  //ÅäÖÃÖØÔØÖµ£¬Ã¿Ãë²úÉú1500´ÎÖÐ¶Ï£¬                        SYS_MCLK   (11059200/
             -12)
 106   1          RCAP2L = (65536 - SYS_MCLK/baud);       //ÒÔÊ¹Ë¢ÐÂÂÊ´ïµ½100HzÎÞÉÁË¸µÄÐ§¹û                           ÏµÍ³Ö÷Ê±ÖÓÆµÂÊ£¬¼´Õñµ´Æ÷Æ
             -µÂÊ¡Â12
 107   1          TH2 = RCAP2H;  //ÉèÖÃ³õÖµµÈÓÚÖØÔØÖµ
 108   1          TL2 = RCAP2L;
 109   1          ET2 = 1;       //Ê¹ÄÜT2ÖÐ¶Ï
 110   1          PT2 = 1;       //ÉèÖÃT2ÖÐ¶ÏÎª¸ßÓÅÏÈ¼¶
 111   1          TR2 = 1;       //Æô¶¯T2
 112   1      }
 113          
 114          void ShowTempHumi()                     // ÏÔÊ¾ÎÂÊª¶ÈÖÁÒº¾§ÆÁ
C51 COMPILER V9.54   MAIN                                                                  10/12/2015 11:40:48 PAGE 3   

 115          {
 116   1              
 117   1              TrasfToString(str,U8T_data_H);
 118   1              ShowStr(6,0,str);
 119   1              TrasfToString(str,U8RH_data_H);
 120   1              ShowStr(6,1,str);
 121   1      }
 122          
 123          void Alarm_Monitor()            // ¼à¿Ø¸÷Ö¸±ê_ ÎÂ¶È¡¢Êª¶È¡¢ÓÐº¦ÆøÌåÅ¨¶È
 124          {
 125   1              
 126   1                      if(U8T_data_H >= 35)    // µ±ÎÂ¶È >= 35¡ãC Ê±
 127   1                      {
 128   2                              ShowStr(14,0,"!~");
 129   2                              ENA_Temp2 = 1;
 130   2                              enbuzz2 = 1;
 131   2                      }
 132   1                      else
 133   1                      {
 134   2                              ShowStr(14,0,"  ");
 135   2                              ENA_Temp2 = 0;
 136   2                              enbuzz2 = 0;
 137   2                      }
 138   1                      
 139   1                      if(U8RH_data_H >= 60)   // µ±Êª¶È >= 60% Ê±
 140   1                      {
 141   2                              ShowStr(14,1,"!~");
 142   2                              enbuzz3 = 1;
 143   2                      }
 144   1                      else
 145   1                      {
 146   2                              ShowStr(14,1,"  ");
 147   2                              enbuzz3 = 0;
 148   2                      }
 149   1                      
 150   1                      if(DOUT==0)             // ¼ì²âÓÐº¦ÆøÌåÅ¨¶ÈÊÇ·ñ³¬±ê
 151   1                              {
 152   2                                      Delay(1);       // ÑÓÊ±ÔÙ´ÎÈ·ÈÏ
 153   2                                      if(DOUT == 0)   // µ±ÓÐº¦ÆøÌåÅ¨¶È³¬±ê
 154   2                                      {
 155   3                                              enbuzz1 = 1;
 156   3                                              ENA_Temp1 = 1;
 157   3                                              
 158   3                                              if(SendOn == 2)
 159   3                                              {
 160   4                                                       SendOn = 1; 
 161   4                                              }
 162   3                                              
 163   3                                      }
 164   2                              }
 165   1                       else
 166   1                              {
 167   2                                      enbuzz1 = 0;
 168   2                                      ENA_Temp1 = 0;
 169   2                              }
 170   1                              
 171   1      }
 172          /*
 173          void Alarm_Action()                     // Ö¸±êÒì³£ Ö´ÐÐ²Ù×÷
 174          {
 175                  if((ENA_Temp1 == 1) || (ENA_Temp2 == 1))        // Æô¶¯·çÉÈ ³é·ç ½µÎÂ
 176                  {
C51 COMPILER V9.54   MAIN                                                                  10/12/2015 11:40:48 PAGE 4   

 177                          ENA = 1;
 178                  }
 179                  else
 180                  {
 181                          ENA = 0;
 182                  }
 183          }
 184          */
 185          //----------------------------------------------
 186          void main()
 187          {
 188   1              P1 = 0xff;
 189   1              INA = 0;
 190   1              INB = 1;
 191   1              ENA = 0;
 192   1              
 193   1              EA = 1;
 194   1              ConfigTimer0(20);               // 20 X 50 = 1 S
 195   1              ConfigTimer2(1000);             // Ã¿Ãë 1000´Î
 196   1              Init1602();
 197   1              SerialInti();
 198   1              
 199   1              ShowStr(0,0,"Temp:");
 200   1              ShowStr(0,1,"Humi:");
 201   1              
 202   1              Delay(1);         //ÑÓÊ±100US£¨12M¾§Õñ)
 203   1              
 204   1              while(1)
 205   1              {
 206   2                      
 207   2      /*  µ÷ÓÃÎÂÊª¶È¶ÁÈ¡×Ó³ÌÐò ¶ÁÈ¡ÎÂÊª¶È£¡ */
 208   2                      R_HT();
 209   2                              
 210   2                              
 211   2                      if(flag1s == 1)         
 212   2                      {
 213   3                              flag1s = 0;
 214   3                              
 215   3                              ShowTempHumi();         // ½«ÎÂÊª¶ÈÏÔÊ¾ÔÚÒº¾§ÆÁÉÏ
 216   3                              
 217   3                              Alarm_Monitor();        // ¼à¿Ø¸÷Ö¸±ê
 218   3                              
 219   3                              //Alarm_Action();               // ·çÉÈ»ú  , ÏÂÃæÖÐ¶Ï¿ØÖÆ£¡~
 220   3                      }               
 221   2                      
 222   2              }//while
 223   1              
 224   1      }// main
 225          
 226          // ---------------------------------------------
 227          void Timer0() interrupt 1
 228          {
 229   1              static U8 timer1 = 0;
 230   1              
 231   1              TH0 = T0RH;
 232   1              TL0 = T0RL;
 233   1              
 234   1              
 235   1              timer1++;
 236   1              
 237   1              if(timer1 == 50)                // ¼ÆÊ± 20 X 50 ==> 1 S
 238   1              {
C51 COMPILER V9.54   MAIN                                                                  10/12/2015 11:40:48 PAGE 5   

 239   2                      timer1 = 0;
 240   2                      flag1s = 1;
 241   2              }
 242   1              
 243   1              if((ENA_Temp1 == 1) || (ENA_Temp2 == 1))        // Æô¶¯·çÉÈ ³é·ç ½µÎÂ***************************
 244   1              {
 245   2                      ENA = 1;
 246   2              }
 247   1              else
 248   1              {
 249   2                      ENA = 0;
 250   2              }
 251   1              
 252   1              if(SendOn == 1)
 253   1              {
 254   2                      SendOn = 0;
 255   2                      Sendit();
 256   2              }
 257   1      }
 258          
 259          void Timer2() interrupt 5
 260          {
 261   1              TF2 = 0;  //ÇåÁãT2ÖÐ¶Ï±êÖ¾
 262   1              
 263   1              if((enbuzz1 == 1) || (enbuzz2 == 1) || ((enbuzz3 == 1)))        // ´ò¿ª·äÃùÆ÷ ~BUZZ
 264   1              {
 265   2                      BUZZ = ~BUZZ;
 266   2              }
 267   1              else
 268   1              {
 269   2                      BUZZ = 1;
 270   2              }
 271   1              
 272   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    707    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
